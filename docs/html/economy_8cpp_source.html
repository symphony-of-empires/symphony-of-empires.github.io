<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Symphony Of Empires: game/src/server/economy.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Symphony Of Empires
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('economy_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">economy.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="economy_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Symphony of Empires</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Copyright (C) 2021, Symphony of Empires contributors</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// This program is free software; you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// (at your option) any later version.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// GNU General Public License for more details.</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// You should have received a copy of the GNU General Public License along</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// with this program; if not, write to the Free Software Foundation, Inc.,</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// Name:</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">//      server/economy.cpp</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">// Abstract:</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">//      Does some important stuff.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">// ----------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="action_8hpp.html">action.hpp</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="economy_8hpp.html">server/economy.hpp</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="world_8hpp.html">world.hpp</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="print_8hpp.html">unified_render/print.hpp</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="serializer_8hpp.html">unified_render/serializer.hpp</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="io__impl_8hpp.html">io_impl.hpp</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="server__network_8hpp.html">server/server_network.hpp</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="thread__pool_8hpp.html">unified_render/thread_pool.hpp</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="product_8hpp.html">product.hpp</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="good_8hpp.html">good.hpp</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="emigration_8hpp.html">emigration.hpp</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#undef min</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#undef max</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">// Visual Studio does not define ssize_t because it&#39;s a POSIX-only type</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#ifdef _MSC_VER</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">typedef</span> <span class="keywordtype">signed</span> <span class="keywordtype">int</span> ssize_t;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">// Structure that represents a person emigrating from a province to another</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="class_workers.html">   51</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_workers.html">Workers</a> {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="class_workers.html#a3ddac131401b8cb1acc30c533f992f20">   53</a></span>&#160;    <a class="code" href="class_pop.html">Pop</a>&amp; <a class="code" href="class_workers.html#a3ddac131401b8cb1acc30c533f992f20">pop</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">   54</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="class_workers.html#a8745b24f7772e1d286212d010cb5c6cd">   55</a></span>&#160;    <a class="code" href="class_workers.html#a8745b24f7772e1d286212d010cb5c6cd">Workers</a>(<a class="code" href="class_pop.html">Pop</a>&amp; _pop): <a class="code" href="class_workers.html#a3ddac131401b8cb1acc30c533f992f20">pop</a>{ _pop }, <a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a>{ _pop.size } {};</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="class_workers.html#a6c20281a83794093cb670b0f03cd45c4">   57</a></span>&#160;    <a class="code" href="class_workers.html">Workers</a>&amp; <a class="code" href="class_workers.html#a6c20281a83794093cb670b0f03cd45c4">operator=</a>(<span class="keyword">const</span> <a class="code" href="class_workers.html">Workers</a>&amp; workers) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <a class="code" href="class_workers.html#a3ddac131401b8cb1acc30c533f992f20">pop</a> = workers.<a class="code" href="class_workers.html#a3ddac131401b8cb1acc30c533f992f20">pop</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a> = workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;};</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="class_available_workers.html">   64</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_available_workers.html">AvailableWorkers</a> {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="class_available_workers.html#a8b65a6141e47031474a062c35b5437d4">   66</a></span>&#160;    std::vector&lt;Workers&gt; <a class="code" href="class_available_workers.html#a8b65a6141e47031474a062c35b5437d4">entrepreneurs</a>{};</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="class_available_workers.html#a8f85a039ce3df6c543ad183b05d2fad9">   67</a></span>&#160;    std::vector&lt;Workers&gt; <a class="code" href="class_available_workers.html#a8f85a039ce3df6c543ad183b05d2fad9">farmers</a>{};</div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="class_available_workers.html#a939e674269cde77d66104c9fe17753bf">   68</a></span>&#160;    std::vector&lt;Workers&gt; <a class="code" href="class_available_workers.html#a939e674269cde77d66104c9fe17753bf">laborers</a>{};</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// AvailableWorkers() {};</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;};</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> std::vector&lt;AvailableWorkers&gt; get_available_workers(<a class="code" href="class_world.html">World</a>&amp; world) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    std::vector&lt;AvailableWorkers&gt; available_workers;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; province : world.provinces) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="comment">// Province must have a controller</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">if</span>(province-&gt;controller == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            available_workers.push_back(<a class="code" href="class_available_workers.html">AvailableWorkers</a>{});</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="class_available_workers.html">AvailableWorkers</a> province_workers{};</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; pop : province-&gt;pops) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            <span class="keywordflow">if</span>(pop.type-&gt;group == <a class="code" href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5afe25c0ad752c03ce2361025c235b63e1">PopGroup::Slave</a> || pop.type-&gt;group == <a class="code" href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5a6311ae17c1ee52b36e68aaf4ad066387">PopGroup::Other</a>) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;            <a class="code" href="class_workers.html">Workers</a> workers{ pop };</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordflow">if</span>(!province-&gt;controller-&gt;is_accepted_culture(pop)) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <span class="comment">// POPs of non-accepted cultures on exterminate mode cannot get jobs</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                <span class="keywordflow">if</span>(province-&gt;controller-&gt;current_policy.treatment == <a class="code" href="policy_8hpp.html#a4d4d7a8da93e4613d8962b1bdabd2ed2aa2494cd90fcce48b63778004d092747d">TREATMENT_EXTERMINATE</a>) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span>(province-&gt;controller-&gt;current_policy.treatment == <a class="code" href="policy_8hpp.html#a4d4d7a8da93e4613d8962b1bdabd2ed2ad96ea9c137d1222a9096df439331f40f">TREATMENT_ONLY_ACCEPTED</a>) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a> /= 2;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">switch</span>(pop.type-&gt;group) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5a638d629a6f2e9ca3a3690b6a854a0717">PopGroup::BURGEOISE</a>:</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                province_workers.entrepreneurs.push_back(workers);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5a7717dca1543a25f26c3c40d28865d638">PopGroup::FARMER</a>:</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                province_workers.farmers.push_back(workers);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5ad03ec8dec3adf3138f3ae310671d3311">PopGroup::LABORER</a>:</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                province_workers.laborers.push_back(workers);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        available_workers.push_back(province_workers);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">return</span> available_workers;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">// Phase 1 of economy: Delivers &amp; Orders are sent from all factories in the world</span></div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="namespace_economy.html#a488d7af1a7c2420a09739101ae79fddd">  118</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespace_economy.html#a488d7af1a7c2420a09739101ae79fddd">Economy::do_tick</a>(<a class="code" href="class_world.html">World</a>&amp; world) {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <span class="keyword">auto</span> available_workers = get_available_workers(world);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keyword">auto</span> orders_good = std::vector&lt;std::vector&lt;OrderGoods&gt;&gt;(world.goods.size());</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="comment">// Buildings who have fullfilled requirements to build stuff will spawn a unit</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; world.buildings.size(); j++) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="keyword">auto</span>&amp; building = world.buildings[j];</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keyword">auto</span>* province = building-&gt;get_province();</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">if</span>(province-&gt;controller == <span class="keyword">nullptr</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="keywordtype">size_t</span> needed_laborers = 0, available_laborers = 0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordtype">size_t</span> needed_farmers = 0, available_farmers = 0;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordtype">size_t</span> needed_entrepreneurs = 0, available_entrepreneurs = 0;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">if</span>(building-&gt;type-&gt;is_factory) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <span class="comment">// Each output adds a required farmer or laborer depending on the type</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="comment">// of output, it also requires entrepreneurs to &quot;manage&quot; the operations</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            <span class="comment">// of the factory</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            <span class="keywordtype">size_t</span> i = 0;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; output : building-&gt;output_products) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                <span class="comment">// The minimum amount of workers needed is given by the employees_needed_per_output vector :)</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                <span class="comment">//const size_t employed = std::min&lt;size_t&gt;(std::pow(10.f * (output-&gt;supply - output-&gt;demand) / std::max&lt;size_t&gt;(output-&gt;demand, 1), 2), building-&gt;employees_needed_per_output[i]);</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">size_t</span> employed = 500;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <span class="keywordflow">if</span>(output-&gt;good-&gt;is_edible) {</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                    needed_farmers += employed;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                    needed_laborers += employed;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                needed_entrepreneurs += employed / 100;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                ++i;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            needed_laborers = 50;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            needed_farmers = 50;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            needed_entrepreneurs = 50;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;        }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_entity.html#abdfc45f6142500ce5600bf056823b9eb">Province::Id</a> province_id = world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(province);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keyword">auto</span> province_workers = available_workers[province_id];</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="comment">// Search through all the job requests</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        <span class="comment">// Industries require 2 (or 3) types of POPs to correctly function</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="comment">// - Laborers: They are needed to produce non-edible food</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="comment">// - Farmers: They are needed to produce edibles</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="comment">// - BURGEOISE: They help &quot;organize&quot; the factory</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; province_workers.farmers.size(); i++) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;            <span class="keywordflow">if</span>(available_farmers &gt;= needed_farmers) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            <a class="code" href="class_workers.html">Workers</a>&amp; workers = province_workers.farmers[i];</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">size_t</span> employed = std::min(needed_farmers - available_farmers, workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a>);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            available_farmers += employed;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="comment">// Give pay to the POP</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">float</span> payment = employed * province-&gt;controller-&gt;current_policy.min_wage;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            workers.<a class="code" href="class_workers.html#a3ddac131401b8cb1acc30c533f992f20">pop</a>.<a class="code" href="class_pop.html#a8b51e6065e766c302912653fa6c9c1ae">budget</a> += payment * building-&gt;get_owner()-&gt;get_salary_paid_mod();</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            building-&gt;budget -= payment;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a> -= employed;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="comment">// Delete job request when it has 0 amount</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordflow">if</span>(!workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a>) {</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                province_workers.farmers.erase(province_workers.farmers.begin() + i);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                --i;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; province_workers.laborers.size(); i++) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            <span class="keywordflow">if</span>(available_laborers &gt;= needed_laborers) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <a class="code" href="class_workers.html">Workers</a>&amp; workers = province_workers.laborers[i];</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">size_t</span> employed = std::min(needed_laborers - available_laborers, workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a>);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            available_laborers += employed;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160; </div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="comment">// Give pay to the POP</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">float</span> payment = employed * province-&gt;controller-&gt;current_policy.min_wage;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;            workers.<a class="code" href="class_workers.html#a3ddac131401b8cb1acc30c533f992f20">pop</a>.<a class="code" href="class_pop.html#a8b51e6065e766c302912653fa6c9c1ae">budget</a> += payment * building-&gt;get_owner()-&gt;get_salary_paid_mod();</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            building-&gt;budget -= payment;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a> -= employed;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="comment">// Delete job request when it has 0 amount</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">if</span>(!workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a>) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                province_workers.laborers.erase(province_workers.laborers.begin() + i);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                --i;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; province_workers.entrepreneurs.size(); i++) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="keywordflow">if</span>(available_entrepreneurs &gt;= needed_entrepreneurs) <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <a class="code" href="class_workers.html">Workers</a>&amp; workers = province_workers.entrepreneurs[i];</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">size_t</span> employed = std::min(needed_entrepreneurs - available_entrepreneurs, workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a>);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            available_entrepreneurs += employed;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160; </div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="comment">// Give pay to the POP</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">float</span> payment = employed * province-&gt;controller-&gt;current_policy.min_wage;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            workers.<a class="code" href="class_workers.html#a3ddac131401b8cb1acc30c533f992f20">pop</a>.<a class="code" href="class_pop.html#a8b51e6065e766c302912653fa6c9c1ae">budget</a> += payment * building-&gt;get_owner()-&gt;get_salary_paid_mod();</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            building-&gt;budget -= payment;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a> -= employed;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160; </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="comment">// Delete job request when it has 0 amount</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">if</span>(!workers.<a class="code" href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">amount</a>) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                province_workers.entrepreneurs.erase(province_workers.entrepreneurs.begin() + i);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                --i;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">if</span>(building-&gt;working_unit_type != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordtype">bool</span> can_build_unit = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; req : building-&gt;req_goods_for_unit) {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="comment">// Increment demand for all products with same required good type</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; product : world.products) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    <span class="keywordflow">if</span>(product-&gt;good != req.first) {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    }</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160; </div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                    <span class="comment">// Government-required supplies are super important for companies</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    product-&gt;demand += std::max(100.f, req.second / 1000.f);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                <span class="keywordflow">if</span>(req.second) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                    can_build_unit = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="comment">// TODO: Make a proper supply chain system with the whole working economy thing :)</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            <span class="comment">// NOTE: Uncomment when it&#39;s ready :)</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="comment">//can_build_unit = true;</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="keywordflow">if</span>(can_build_unit) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="comment">// Spawn a unit</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <a class="code" href="class_unit.html">Unit</a>* unit = <span class="keyword">new</span> <a class="code" href="class_unit.html">Unit</a>();</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#a459c322351b83aeb29a33f3a5e192bda">set_province</a>(*building-&gt;get_province());</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#ab0f889c1dcbe02864fad1fa6af62aa37">type</a> = building-&gt;working_unit_type;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#a7fecad7239d042c63f6fb35654bc6228">owner</a> = building-&gt;get_owner();</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#af0fc19a0b834d99a79e320bbb323f1a7">budget</a> = 5000.f;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#aa1ba06b112a04b64523abe7ae9033c23">experience</a> = 1.f;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#a39f6e9f21ee9a4ec4f54a8eb39745c26">morale</a> = 1.f;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#a92c7132df3c497b8a1d970e10ec0da58">supply</a> = 1.f;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#a2ed994b8257c603d540e2f08b1fe0f57">defensive_ticks</a> = 0;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#a4ab07faf29a245f3ac4a5ee2215c7e36">size</a> = unit-&gt;<a class="code" href="class_unit.html#ab0f889c1dcbe02864fad1fa6af62aa37">type</a>-&gt;<a class="code" href="class_unit_type.html#ae1080a28864c59aee1eea89313f8f7b4">max_health</a>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                unit-&gt;<a class="code" href="class_unit.html#ade569a5a70e47be8c0b98b2c27eb0dc5">base</a> = unit-&gt;<a class="code" href="class_unit.html#a4ab07faf29a245f3ac4a5ee2215c7e36">size</a>;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                </div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                <span class="comment">// Notify all clients of the server about this new unit</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                building-&gt;working_unit_type = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                world.<a class="code" href="class_world.html#a414eabf82ea5586d568450c46e55a53a">insert</a>(unit);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                <a class="code" href="class_unified_render_1_1_networking_1_1_packet.html">UnifiedRender::Networking::Packet</a> packet = <a class="code" href="class_unified_render_1_1_networking_1_1_packet.html">UnifiedRender::Networking::Packet</a>();</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                <a class="code" href="class_archive.html">Archive</a> ar = <a class="code" href="class_archive.html">Archive</a>();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <a class="code" href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950b">ActionType</a> action = <a class="code" href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950babe7a91c1d60fbbbcab57ee6b6d4484c9">ActionType::UNIT_ADD</a>;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                <a class="code" href="serializer_8hpp.html#a0de36c411404bc17fd91b94b25823552">::serialize</a>(ar, &amp;action); <span class="comment">// ActionInt</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                <a class="code" href="serializer_8hpp.html#a0de36c411404bc17fd91b94b25823552">::serialize</a>(ar, unit); <span class="comment">// UnitObj</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                packet.<a class="code" href="class_unified_render_1_1_networking_1_1_packet.html#a572c99ae39603961d621eef977312fbe">data</a>(ar.<a class="code" href="class_archive.html#a4058a4361793f2214b9ca27f4f4d6b74">get_buffer</a>(), ar.<a class="code" href="class_archive.html#a83d3cc33add24511ced9c7e7d467a09c">size</a>());</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <a class="code" href="server__network_8cpp.html#a4528211a12b7127900078415d20510af">g_server</a>-&gt;<a class="code" href="class_unified_render_1_1_networking_1_1_server.html#a1b478ce1f62b20d08bbae558bee6053f">broadcast</a>(packet);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                <a class="code" href="print_8hpp.html#a4d6d61888d367fc052c4491545bd0560">print_info</a>(<span class="stringliteral">&quot;[%s]: Has built an unit of [%s]&quot;</span>, building-&gt;get_province()-&gt;ref_name.c_str(), unit-&gt;<a class="code" href="class_unit.html#ab0f889c1dcbe02864fad1fa6af62aa37">type</a>-&gt;<a class="code" href="class_refname_entity.html#af7cab6ed6df7dc18b4022a76e7faa0f6">ref_name</a>.c_str());</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;            }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">if</span>(building-&gt;type-&gt;is_factory) {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <span class="keywordflow">if</span>(building-&gt;budget &lt; 0.f) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                    <a class="code" href="class_unified_render_1_1_networking_1_1_packet.html">UnifiedRender::Networking::Packet</a> packet = <a class="code" href="class_unified_render_1_1_networking_1_1_packet.html">UnifiedRender::Networking::Packet</a>();</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    <a class="code" href="class_archive.html">Archive</a> ar = <a class="code" href="class_archive.html">Archive</a>();</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    <a class="code" href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950b">ActionType</a> action = <a class="code" href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950bae62f4443f20859b05eed4e00137fbfe7">ActionType::BUILDING_REMOVE</a>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    <a class="code" href="serializer_8hpp.html#a0de36c411404bc17fd91b94b25823552">::serialize</a>(ar, &amp;action);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                    <a class="code" href="serializer_8hpp.html#a0de36c411404bc17fd91b94b25823552">::serialize</a>(ar, &amp;building);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    packet.<a class="code" href="class_unified_render_1_1_networking_1_1_packet.html#a572c99ae39603961d621eef977312fbe">data</a>(ar.<a class="code" href="class_archive.html#a4058a4361793f2214b9ca27f4f4d6b74">get_buffer</a>(), ar.<a class="code" href="class_archive.html#a83d3cc33add24511ced9c7e7d467a09c">size</a>());</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                    <a class="code" href="server__network_8cpp.html#a4528211a12b7127900078415d20510af">g_server</a>-&gt;<a class="code" href="class_unified_render_1_1_networking_1_1_server.html#a1b478ce1f62b20d08bbae558bee6053f">broadcast</a>(packet);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                <a class="code" href="print_8hpp.html#a4d6d61888d367fc052c4491545bd0560">print_info</a>(<span class="stringliteral">&quot;Building of [%s] in [%s] has closed down!&quot;</span>, building-&gt;type-&gt;ref_name.c_str(), province-&gt;ref_name.c_str());</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                world.<a class="code" href="class_world.html#a185d53b9f3e8d886f3f955c2c65b8725">remove</a>(building);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keyword">delete</span> building;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                j--;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            building-&gt;workers = available_farmers + available_laborers + available_entrepreneurs;</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            <span class="comment">/*print_info(&quot;[%s]: %zu workers on building of type [%s]&quot;, building-&gt;get_province()-&gt;ref_name.c_str(), building-&gt;workers, building-&gt;type-&gt;ref_name.c_str());</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">            print_info(&quot;- %zu farmers (%zu needed)&quot;, available_farmers, needed_farmers);</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">            print_info(&quot;- %zu laborers (%zu needed)&quot;, available_laborers, needed_laborers);</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">            print_info(&quot;- %zu entrepreneurs (%zu needed)&quot;, available_entrepreneurs, needed_entrepreneurs);*/</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordflow">if</span>(!building-&gt;workers) {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                building-&gt;days_unoperational++;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                <span class="comment">// TODO: We should tax building daily income instead of by it&#39;s total budget</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">float</span> loss_by_tax = building-&gt;budget * province-&gt;controller-&gt;current_policy.industry_tax;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                building-&gt;budget -= loss_by_tax;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                province-&gt;controller-&gt;budget += loss_by_tax;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                <a class="code" href="print_8hpp.html#a4d6d61888d367fc052c4491545bd0560">print_info</a>(<span class="stringliteral">&quot;[%s]: %zu workers on building of type [%s]&quot;</span>, building-&gt;get_province()-&gt;ref_name.c_str(), 0, building-&gt;type-&gt;ref_name.c_str());</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            building-&gt;days_unoperational = 0;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            world.<a class="code" href="class_world.html#a2ed877da2e26c03c419c21f1631d0725">orders_mutex</a>.lock();</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; input : building-&gt;type-&gt;inputs) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                <a class="code" href="class_order_goods.html">OrderGoods</a> order = {};</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                order.<a class="code" href="class_order_goods.html#ad3a7abc7ad5331b9b554127290d443a9">payment</a> = building-&gt;willing_payment;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                order.<a class="code" href="class_order_goods.html#a68b0235e745d82fbaa9a18b33910eb74">good</a> = input;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a> = building;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a> = province;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                order.<a class="code" href="class_order_goods.html#afe9740a8f611b2d3ef97b65ee8472666">type</a> = <a class="code" href="world_8hpp.html#a57124e387290311f33f3b54a54930418acb90f4484ab1c9ce5a9c4328bd3c8dbc">OrderType::INDUSTRIAL</a>;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                <span class="comment">// Farmers can only work with edibles and laborers can only work for edibles</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="keywordflow">if</span>(input-&gt;is_edible) {</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                    order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a> = (available_farmers / needed_farmers) * 5000;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                    order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a> = (available_laborers / needed_laborers) * 5000;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                }</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <span class="keywordflow">if</span>(!order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a>) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a> *= building-&gt;get_owner()-&gt;get_industry_input_mod();</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                world.<a class="code" href="class_world.html#ab132ceb31bcac554784a2c533a139395">orders</a>.push_back(order);</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160; </div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                <span class="comment">// Increase demand for all products with same good type as ordered (incentivizing companies to create more of this)</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; product : world.products) {</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    <span class="keywordflow">if</span>(product-&gt;good != order.<a class="code" href="class_order_goods.html#a68b0235e745d82fbaa9a18b33910eb74">good</a>) {</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                    }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    product-&gt;demand += std::min(100.f, order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a> / 1000.f);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                }</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            world.<a class="code" href="class_world.html#a2ed877da2e26c03c419c21f1631d0725">orders_mutex</a>.unlock();</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="comment">//if(!building-&gt;can_do_output()) continue;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="comment">// Now produce anything as we can!</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="comment">// Place deliver orders (we are a RGO)</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            world.<a class="code" href="class_world.html#aa1f1181da420bc00877e11997c8a05fa">delivers_mutex</a>.lock();</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> k = 0; k &lt; building-&gt;type-&gt;outputs.size(); k++) {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <a class="code" href="class_deliver_goods.html">DeliverGoods</a> deliver = {};</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                deliver.<a class="code" href="class_deliver_goods.html#a6e3be06b7461e173316b2cb62770fb1d">payment</a> = building-&gt;willing_payment;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                deliver.<a class="code" href="class_deliver_goods.html#a7b126da233200a2b9c914c7a903770d1">good</a> = building-&gt;type-&gt;outputs[k];</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                deliver.<a class="code" href="class_deliver_goods.html#ad0d61a2b2e51ab005086ca43fabcbcd1">building</a> = building;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                deliver.<a class="code" href="class_deliver_goods.html#a7406c05c8810773dc81a046a9f0daea3">province</a> = province;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a> = building-&gt;output_products[k];</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                <span class="keywordflow">if</span>(deliver.<a class="code" href="class_deliver_goods.html#a7b126da233200a2b9c914c7a903770d1">good</a>-&gt;<a class="code" href="class_good.html#ab112bb52758716660c41803684e857fa">is_edible</a>) {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                    deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a> = (available_farmers / needed_farmers) * 5000;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                    deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a> = (available_laborers / needed_laborers) * 5000;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                <span class="keywordflow">if</span>(!deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a>) {</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a> *= building-&gt;get_owner()-&gt;get_industry_output_mod();</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                <span class="comment">// Cannot be below production cost, so we can be profitable and we need</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                <span class="comment">// to raise prices</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                <span class="keywordflow">if</span>(deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a>-&gt;<a class="code" href="class_product.html#ad1fd6ee6c8653bf81898668b1d01b05d">price</a> &lt; building-&gt;production_cost * 1.2f) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a>-&gt;<a class="code" href="class_product.html#ad1fd6ee6c8653bf81898668b1d01b05d">price</a> = building-&gt;production_cost * 1.2f;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>.push_back(deliver);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            world.<a class="code" href="class_world.html#aa1f1181da420bc00877e11997c8a05fa">delivers_mutex</a>.unlock();</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="comment">// Willing payment is made for next day ;)</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            building-&gt;willing_payment = building-&gt;budget / building-&gt;type-&gt;inputs.size() + building-&gt;type-&gt;outputs.size();</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="comment">// Building the building itself</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; good : building-&gt;req_goods) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="keywordflow">if</span>(!good.second) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            }</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <a class="code" href="class_order_goods.html">OrderGoods</a> order = {};</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a> = good.second;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a> *= building-&gt;get_owner()-&gt;get_industry_input_mod();</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="comment">// TODO: Make this dynamic</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            order.<a class="code" href="class_order_goods.html#ad3a7abc7ad5331b9b554127290d443a9">payment</a> = building-&gt;willing_payment;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            order.<a class="code" href="class_order_goods.html#a68b0235e745d82fbaa9a18b33910eb74">good</a> = good.first;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a> = building;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a> = building-&gt;get_province();</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            order.<a class="code" href="class_order_goods.html#afe9740a8f611b2d3ef97b65ee8472666">type</a> = <a class="code" href="world_8hpp.html#a57124e387290311f33f3b54a54930418a71a6834884666147c0334f0c40bc7295">OrderType::BUILDING</a>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            world.<a class="code" href="class_world.html#ab132ceb31bcac554784a2c533a139395">orders</a>.push_back(order);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        }</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="comment">// TODO: We should deduct and set willing payment from military spendings</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="comment">// Building an unit</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; good : building-&gt;req_goods_for_unit) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">if</span>(!good.second) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160; </div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            <a class="code" href="class_order_goods.html">OrderGoods</a> order = {};</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a> = good.second;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a> *= building-&gt;get_owner()-&gt;get_industry_input_mod();</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="comment">// TODO: Make this dynamic</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            order.<a class="code" href="class_order_goods.html#ad3a7abc7ad5331b9b554127290d443a9">payment</a> = building-&gt;willing_payment;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            order.<a class="code" href="class_order_goods.html#a68b0235e745d82fbaa9a18b33910eb74">good</a> = good.first;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a> = building;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a> = building-&gt;get_province();</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            order.<a class="code" href="class_order_goods.html#afe9740a8f611b2d3ef97b65ee8472666">type</a> = <a class="code" href="world_8hpp.html#a57124e387290311f33f3b54a54930418aec8fc2c42b9c76effd648a14b311411f">OrderType::UNIT</a>;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            world.<a class="code" href="class_world.html#ab132ceb31bcac554784a2c533a139395">orders</a>.push_back(order);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    {</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="comment">// Take opportunity to also send an update about our buildings</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <a class="code" href="class_unified_render_1_1_networking_1_1_packet.html">UnifiedRender::Networking::Packet</a> packet = <a class="code" href="class_unified_render_1_1_networking_1_1_packet.html">UnifiedRender::Networking::Packet</a>();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        <a class="code" href="class_archive.html">Archive</a> ar = <a class="code" href="class_archive.html">Archive</a>();</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <a class="code" href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950b">ActionType</a> action = <a class="code" href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950ba6c2b08f490c9fc0ad047ab644d3aa498">ActionType::BUILDING_UPDATE</a>;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <a class="code" href="serializer_8hpp.html#a0de36c411404bc17fd91b94b25823552">::serialize</a>(ar, &amp;action); <span class="comment">// ActionInt</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <a class="code" href="class_entity.html#abdfc45f6142500ce5600bf056823b9eb">Building::Id</a> size = world.buildings.size();</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <a class="code" href="serializer_8hpp.html#a0de36c411404bc17fd91b94b25823552">::serialize</a>(ar, &amp;size);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; building : world.buildings) {</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            <a class="code" href="serializer_8hpp.html#a0de36c411404bc17fd91b94b25823552">::serialize</a>(ar, &amp;building); <span class="comment">// BuildingRef</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <a class="code" href="serializer_8hpp.html#a0de36c411404bc17fd91b94b25823552">::serialize</a>(ar, building); <span class="comment">// BuildingObj</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        packet.<a class="code" href="class_unified_render_1_1_networking_1_1_packet.html#a572c99ae39603961d621eef977312fbe">data</a>(ar.<a class="code" href="class_archive.html#a4058a4361793f2214b9ca27f4f4d6b74">get_buffer</a>(), ar.<a class="code" href="class_archive.html#a83d3cc33add24511ced9c7e7d467a09c">size</a>());</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <a class="code" href="server__network_8cpp.html#a4528211a12b7127900078415d20510af">g_server</a>-&gt;<a class="code" href="class_unified_render_1_1_networking_1_1_server.html#a1b478ce1f62b20d08bbae558bee6053f">broadcast</a>(packet);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// Sort on best payment first for orders and delivers</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    std::sort(world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>.begin(), world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>.end(), [](<span class="keyword">const</span> <a class="code" href="class_deliver_goods.html">DeliverGoods</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="class_deliver_goods.html">DeliverGoods</a>&amp; rhs) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        return lhs.payment &gt; rhs.payment;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    });</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    std::sort(world.<a class="code" href="class_world.html#ab132ceb31bcac554784a2c533a139395">orders</a>.begin(), world.<a class="code" href="class_world.html#ab132ceb31bcac554784a2c533a139395">orders</a>.end(), [](<span class="keyword">const</span> <a class="code" href="class_order_goods.html">OrderGoods</a>&amp; lhs, <span class="keyword">const</span> <a class="code" href="class_order_goods.html">OrderGoods</a>&amp; rhs) {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        return lhs.payment &gt; rhs.payment;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    });</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    orders_good.shrink_to_fit();</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; order : world.<a class="code" href="class_world.html#ab132ceb31bcac554784a2c533a139395">orders</a>) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="comment">// TODO: This should NOT happen!!!</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="keywordflow">if</span>(order.good == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        orders_good[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(order.good)].push_back(order);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    }</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="comment">// Phase 2 of the economy: Goods are transported all around the world, generating commerce and making them</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="comment">// be ready for POPs to buy</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160; </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="comment">// We will check all transport companies; they will transport in a first-come first-serve fashion</span></div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// Check all delivers</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>.size(); i++) {</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <a class="code" href="class_deliver_goods.html">DeliverGoods</a>&amp; deliver = world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>[i];</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_policies.html">Policies</a>&amp; deliver_policy = deliver.<a class="code" href="class_deliver_goods.html#a7406c05c8810773dc81a046a9f0daea3">province</a>-&gt;<a class="code" href="class_province.html#a394ab431fc7f6b697e288e562898d123">controller</a>-&gt;<a class="code" href="class_nation.html#a03368edb43be9a4103f636cd83e7e600">current_policy</a>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        <span class="comment">// Building* deliver_building = deliver.building;</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160; </div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="comment">// Check all orders</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="keyword">auto</span>&amp; order_list = orders_good[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(deliver.<a class="code" href="class_deliver_goods.html#a7b126da233200a2b9c914c7a903770d1">good</a>)];</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="comment">//for(size_t j = 0; j &lt; world.orders.size(); j++) {</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> j = 0; j &lt; order_list.size(); j++) {</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;            <a class="code" href="class_order_goods.html">OrderGoods</a>&amp; order = order_list[j];</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;            <span class="keyword">const</span> <a class="code" href="class_policies.html">Policies</a>&amp; order_policy = order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a>-&gt;<a class="code" href="class_province.html#a394ab431fc7f6b697e288e562898d123">controller</a>-&gt;<a class="code" href="class_nation.html#a03368edb43be9a4103f636cd83e7e600">current_policy</a>;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160; </div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <span class="comment">// If foreign trade is not allowed, then order controller === sender controller</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="keywordflow">if</span>(!deliver_policy.<a class="code" href="class_policies.html#a348b5a9b1b76c8822b9200d4a1ce2a4b">foreign_trade</a> || !order_policy.<a class="code" href="class_policies.html#a348b5a9b1b76c8822b9200d4a1ce2a4b">foreign_trade</a>) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="comment">// Trade not allowed</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                <span class="keywordflow">if</span>(order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a>-&gt;<a class="code" href="class_province.html#a394ab431fc7f6b697e288e562898d123">controller</a> != deliver.<a class="code" href="class_deliver_goods.html#a7406c05c8810773dc81a046a9f0daea3">province</a>-&gt;<a class="code" href="class_province.html#a394ab431fc7f6b697e288e562898d123">controller</a>) {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;            }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160; </div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">float</span> order_cost = deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a>-&gt;<a class="code" href="class_product.html#ad1fd6ee6c8653bf81898668b1d01b05d">price</a> * std::min(order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a>, deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a>);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">float</span> deliver_cost = deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a>-&gt;<a class="code" href="class_product.html#ad1fd6ee6c8653bf81898668b1d01b05d">price</a> * std::min(order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a>, deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a>);</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            <span class="keywordtype">float</span> total_order_cost, total_deliver_cost;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <span class="keywordflow">if</span>(order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a>-&gt;<a class="code" href="class_province.html#a394ab431fc7f6b697e288e562898d123">controller</a> != deliver.<a class="code" href="class_deliver_goods.html#a7406c05c8810773dc81a046a9f0daea3">province</a>-&gt;<a class="code" href="class_province.html#a394ab431fc7f6b697e288e562898d123">controller</a>) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                <span class="comment">// International trade</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                total_order_cost = order_cost * order_policy.<a class="code" href="class_policies.html#a2f4987a4a786ea69a700b71b3c63c088">import_tax</a>;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                total_deliver_cost = deliver_cost * order_policy.<a class="code" href="class_policies.html#afb13cbaf9d9c21d136c9f484d5162605">export_tax</a>;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="comment">// Domestic trade</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                total_order_cost = order_cost * order_policy.<a class="code" href="class_policies.html#afa12584fab46c94ce06e9fd4a6119a03">domestic_import_tax</a>;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                total_deliver_cost = deliver_cost * order_policy.<a class="code" href="class_policies.html#ac400ba31e84b53535aaada9a79e22ad4">domestic_export_tax</a>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="comment">// Orders payment should also cover the import tax and a deliver payment should also cover the export</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="comment">// tax too. Otherwise we can&#39;t deliver</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            <span class="keywordflow">if</span>(order.<a class="code" href="class_order_goods.html#ad3a7abc7ad5331b9b554127290d443a9">payment</a> &lt; total_order_cost &amp;&amp; total_order_cost &gt; 0.f) {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                <span class="keywordflow">if</span>(order.<a class="code" href="class_order_goods.html#afe9740a8f611b2d3ef97b65ee8472666">type</a> == <a class="code" href="world_8hpp.html#a57124e387290311f33f3b54a54930418acb90f4484ab1c9ce5a9c4328bd3c8dbc">OrderType::INDUSTRIAL</a>) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                    order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a>-&gt;<a class="code" href="class_building.html#a667f82bbfacc3e503b240c8a5a84451d">willing_payment</a> = total_order_cost;</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(deliver.<a class="code" href="class_deliver_goods.html#a6e3be06b7461e173316b2cb62770fb1d">payment</a> &lt; total_deliver_cost &amp;&amp; total_deliver_cost &gt; 0.f) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                deliver.<a class="code" href="class_deliver_goods.html#ad0d61a2b2e51ab005086ca43fabcbcd1">building</a>-&gt;<a class="code" href="class_building.html#a667f82bbfacc3e503b240c8a5a84451d">willing_payment</a> = total_deliver_cost;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160; </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            <span class="comment">// if(order.type == OrderType::INDUSTRIAL) continue;</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <span class="comment">// Give both goverments their part of the tax (when tax is 1.0&lt; then the goverment pays for it)</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a>-&gt;<a class="code" href="class_province.html#a394ab431fc7f6b697e288e562898d123">controller</a>-&gt;<a class="code" href="class_nation.html#a14c5ba373fc7daf6dabc5e437d6f0b41">budget</a> += total_order_cost - order_cost;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            deliver.<a class="code" href="class_deliver_goods.html#a7406c05c8810773dc81a046a9f0daea3">province</a>-&gt;<a class="code" href="class_province.html#a394ab431fc7f6b697e288e562898d123">controller</a>-&gt;<a class="code" href="class_nation.html#a14c5ba373fc7daf6dabc5e437d6f0b41">budget</a> += total_deliver_cost - deliver_cost;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="comment">// Province receives a small (military) supply buff from commerce</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a>-&gt;<a class="code" href="class_province.html#aaf4829410565c77193db7e5ec474d916">supply_rem</a> += 5.f;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a>-&gt;<a class="code" href="class_province.html#aaf4829410565c77193db7e5ec474d916">supply_rem</a> = std::min(order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a>-&gt;<a class="code" href="class_province.html#a1638dc8d5631d507c6edf4e0a5a8e814">supply_limit</a>, order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a>-&gt;<a class="code" href="class_province.html#aaf4829410565c77193db7e5ec474d916">supply_rem</a>);</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160; </div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;            <span class="comment">// Obtain number of goods that we can satisfy</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="keywordtype">size_t</span> count = std::min&lt;size_t&gt;(order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a>, deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a>);</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keywordflow">if</span>(order.<a class="code" href="class_order_goods.html#afe9740a8f611b2d3ef97b65ee8472666">type</a> == <a class="code" href="world_8hpp.html#a57124e387290311f33f3b54a54930418acb90f4484ab1c9ce5a9c4328bd3c8dbc">OrderType::INDUSTRIAL</a>) {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                <span class="comment">// Duplicate products and put them into the province&#39;s stock (a commerce buff)</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a>-&gt;<a class="code" href="class_building.html#a8b40ee6a2682be3b890df777377fe1c0">add_to_stock</a>(*order.<a class="code" href="class_order_goods.html#a68b0235e745d82fbaa9a18b33910eb74">good</a>, count);</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                <span class="comment">// Increment the production cost of this building which is used</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                <span class="comment">// so we sell our product at a profit instead  of at a loss</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a>-&gt;<a class="code" href="class_building.html#ac88484660cfc58d6cd400963b2f6950e">production_cost</a> += deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a>-&gt;<a class="code" href="class_product.html#ad1fd6ee6c8653bf81898668b1d01b05d">price</a>;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(order.<a class="code" href="class_order_goods.html#afe9740a8f611b2d3ef97b65ee8472666">type</a> == <a class="code" href="world_8hpp.html#a57124e387290311f33f3b54a54930418a71a6834884666147c0334f0c40bc7295">OrderType::BUILDING</a>) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                <span class="comment">// The building will take the production materials</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                <span class="comment">// and use them for building the unit</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a>-&gt;<a class="code" href="class_building.html#a9025c30bac0ba3a0c9092726e643c43c">get_owner</a>()-&gt;<a class="code" href="class_nation.html#a14c5ba373fc7daf6dabc5e437d6f0b41">budget</a> -= total_order_cost;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; p : order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a>-&gt;<a class="code" href="class_building.html#a66ac67d055da2cb3fe5a00755badba34">req_goods</a>) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                    <span class="keywordflow">if</span>(p.first != deliver.<a class="code" href="class_deliver_goods.html#a7b126da233200a2b9c914c7a903770d1">good</a>) {</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                    }</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160; </div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                    p.second -= std::min(p.second, count);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                }</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(order.<a class="code" href="class_order_goods.html#afe9740a8f611b2d3ef97b65ee8472666">type</a> == <a class="code" href="world_8hpp.html#a57124e387290311f33f3b54a54930418aec8fc2c42b9c76effd648a14b311411f">OrderType::UNIT</a>) {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                <span class="comment">// TODO: We should deduct and set willing payment from military spendings</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a>-&gt;<a class="code" href="class_building.html#a9025c30bac0ba3a0c9092726e643c43c">get_owner</a>()-&gt;<a class="code" href="class_nation.html#a14c5ba373fc7daf6dabc5e437d6f0b41">budget</a> -= total_order_cost;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; p : order.<a class="code" href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">building</a>-&gt;<a class="code" href="class_building.html#a66ac67d055da2cb3fe5a00755badba34">req_goods</a>) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                    <span class="keywordflow">if</span>(p.first != deliver.<a class="code" href="class_deliver_goods.html#a7b126da233200a2b9c914c7a903770d1">good</a>) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                    }</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160; </div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                    p.second -= std::min(p.second, count);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                    <a class="code" href="print_8hpp.html#a4d6d61888d367fc052c4491545bd0560">print_info</a>(<span class="stringliteral">&quot;Delivered %zu goods (%zu remaining!), of type %s&quot;</span>, count, p.second, order.<a class="code" href="class_order_goods.html#a68b0235e745d82fbaa9a18b33910eb74">good</a>-&gt;<a class="code" href="class_refname_entity.html#af7cab6ed6df7dc18b4022a76e7faa0f6">ref_name</a>.c_str());</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(order.<a class="code" href="class_order_goods.html#afe9740a8f611b2d3ef97b65ee8472666">type</a> == <a class="code" href="world_8hpp.html#a57124e387290311f33f3b54a54930418aefdb39a4c7286afcecf0e8a7435fce6a">OrderType::POP</a>) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                <span class="comment">// Nobody is to be billed ... transport company still obtains their money &amp; delivers to the province</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                <span class="comment">//order.province-&gt;stockpile[world.get_id(deliver.product)] += order.quantity;</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <span class="comment">// Add to stockpile (duplicate items) to the province at each transporting</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a> -= count;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a> -= count;</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            order.<a class="code" href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">province</a>-&gt;<a class="code" href="class_province.html#a9e169c16f63d4bc6d4b822a188f5d650">stockpile</a>[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a>-&gt;<a class="code" href="class_product.html#a68c5bf7bc5bddd2e1734d8ea1872e836">good</a>)] += count;</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160; </div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a>-&gt;<a class="code" href="class_product.html#a3320d60d1ed5704af3b59788610dd0ca">supply</a> += deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a>;</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160; </div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <span class="comment">// Delete this deliver and order tickets from the system since</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="comment">// they are now fullfilled (only delete when no quanity left)</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            <span class="keywordflow">if</span>(!order.<a class="code" href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">quantity</a>) {</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                order_list.erase(order_list.begin() + j);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            } <span class="keywordflow">if</span>(!deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a>) {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>.erase(world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>.begin() + i);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                i--;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            }</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160; </div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="comment">// Delete the remaining orders</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    orders_good.clear();</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    world.<a class="code" href="class_world.html#ab132ceb31bcac554784a2c533a139395">orders</a>.clear();</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">// The remaining delivers gets dropped and just simply add up the province&#39;s stockpile</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="comment">// Drop all rejected delivers who didn&#39;t got transported</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>.size(); i++) {</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="keyword">const</span> <a class="code" href="class_deliver_goods.html">DeliverGoods</a>&amp; deliver = world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>[i];</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        <span class="comment">// Add up to province stockpile</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        deliver.<a class="code" href="class_deliver_goods.html#a7406c05c8810773dc81a046a9f0daea3">province</a>-&gt;<a class="code" href="class_province.html#a9e169c16f63d4bc6d4b822a188f5d650">stockpile</a>[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a>-&gt;<a class="code" href="class_product.html#a68c5bf7bc5bddd2e1734d8ea1872e836">good</a>)] += deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a>;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="comment">// Increment supply because of incremented stockpile</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        deliver.<a class="code" href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">product</a>-&gt;<a class="code" href="class_product.html#a3320d60d1ed5704af3b59788610dd0ca">supply</a> += deliver.<a class="code" href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">quantity</a>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    world.<a class="code" href="class_world.html#a5b65f000301f0674415c521fc9821056">delivers</a>.clear();</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160; </div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">// TODO: Place stockpiles</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160; </div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <span class="comment">// Phase 3 of economy: POPs buy the aforementioned products and take from the province&#39;s stockpile</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="comment">// Now, it&#39;s like 1 am here, but i will try to write a very nice economic system</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">// TODO: There is a lot to fix here, first the economy system commits inverse great depression and goes way too happy</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    std::for_each(world.provinces.begin(), world.provinces.end(), [&amp;world](<span class="keyword">auto</span>&amp; province) {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        if(province-&gt;controller == nullptr) {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            return;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">if</span>(province-&gt;terrain_type-&gt;is_water_body) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            return;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        }</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160; </div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="comment">//std::vector&lt;Product*&gt; province_products = province-&gt;get_products();</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; province-&gt;pops.size(); i++) {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            Pop&amp; pop = province-&gt;pops[i];</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            <span class="comment">// We want to get rid of many POPs as possible</span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            if(!pop.size) {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                province-&gt;pops.erase(province-&gt;pops.begin() + i);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                i--;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                continue;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <span class="comment">// Use 10% of our budget for buying uneeded commodities and shit</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            <span class="comment">// TODO: Should lower spending with higher literacy, and higher</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <span class="comment">// TODO: Higher the fullfilment per unit with higher literacy</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            <span class="comment">// TODO: DO NOT MAKE POP BUY FROM STOCKPILE, INSTEAD MAKE THEM BUY FROM ORDERS</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; good : world.goods) {</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                <span class="comment">// Province must have stockpile</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                if(!province-&gt;stockpile[world.get_id(good)]) {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                    <span class="comment">// POPs will order it so hopefully transport companies send it</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                    OrderGoods order = OrderGoods{};</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                    order.quantity = pop.size;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                    order.good = good;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                    order.payment = pop.budget;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                    order.province = province;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                    order.quantity = 1000;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                    order.type = OrderType::POP;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                    world.orders.push_back(order);</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                    continue;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                }</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160; </div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> bought;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                bought = std::rand() % pop.size;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                <span class="keywordflow">if</span>(!good-&gt;is_edible) {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                    <span class="comment">// Slaves cannot buy commodities</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                    if(pop.type-&gt;group == PopGroup::Slave) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                        continue;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                    }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                }</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                <span class="comment">// Only buy the available stuff</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                bought = std::min&lt;unsigned int&gt;(bought, province-&gt;stockpile[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(good)]);</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                <span class="keywordflow">if</span>(!bought) {</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                }</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                <span class="comment">// Delete items from stockpile</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                province-&gt;stockpile[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(good)] -= std::min&lt;unsigned int&gt;(province-&gt;stockpile[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(good)], bought);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160; </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                <span class="comment">// Uncomment to see buyers</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                <span class="comment">//print_info(&quot;Pop with budget %f bought %zu %s&quot;, pop.budget, (size_t)bought, product-&gt;good-&gt;name.c_str());</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160; </div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                <span class="keywordflow">if</span>(good-&gt;is_edible) {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                    pop.life_needs_met += (float)pop.size / (<span class="keywordtype">float</span>)bought;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                    pop.everyday_needs_met += (float)pop.size / (<span class="keywordtype">float</span>)bought;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            }</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160; </div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            <span class="comment">// Humans can survive 8 days without eating anything</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            pop.life_needs_met -= 0.01f;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <span class="comment">// x2.5 life needs met modifier, that is the max allowed</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;            pop.life_needs_met = std::min&lt;float&gt;(1.2f, std::max&lt;float&gt;(pop.life_needs_met, -5.f));</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;            pop.everyday_needs_met = std::min&lt;float&gt;(1.5f, std::max&lt;float&gt;(pop.everyday_needs_met, -5.f));</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;            <span class="comment">// Current liking of the party is influenced by the life_needs_met</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;            pop.ideology_approval[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(province-&gt;controller-&gt;ideology)] += (pop.life_needs_met + 1.f) / 10.f;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            <span class="comment">// Higher literacy will mean there will be less births due to sex education</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="comment">// and will also mean that - there would be less deaths due to higher knewledge</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="keywordtype">int</span> growth;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160; </div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="comment">// NOTE: We used to have this thing where anything below 2.5 meant everyone dies</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="comment">// and this was removed because it&#39;s such an unescesary detail that consumes precious</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <span class="comment">// CPU branching prediction... and we can&#39;t afford that!</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;            <span class="comment">// Starvation in -1 or 0 or &gt;1 are amortized by literacy</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            growth = pop.life_needs_met / pop.literacy;</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160; </div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <span class="keywordflow">if</span>(growth &lt; 0 &amp;&amp; (<span class="keywordtype">size_t</span>)std::abs(growth) &gt; pop.size) {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                growth = -pop.size;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;            }</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            growth *= (growth &gt; 0) ? province-&gt;controller-&gt;get_reproduction_mod() : province-&gt;controller-&gt;get_death_mod();</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            pop.size += growth;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="comment">// Add some RNG to shake things up and make gameplay more dynamic and less deterministic :)</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            pop.size += std::rand() % std::min&lt;size_t&gt;(5, std::max&lt;size_t&gt;(1, pop.size / 10000));</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            pop.size = std::max&lt;size_t&gt;(1, pop.size);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            <span class="comment">// Met life needs means less militancy</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            <span class="comment">// For example, having 1.0 life needs means that we obtain -0.01 militancy per ecotick</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <span class="comment">// and the opposite happens with negative life needs</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            pop.militancy += 0.01f * (-pop.life_needs_met);</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            pop.con += 0.01f * (-pop.life_needs_met);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            pop.militancy += 0.01f * province-&gt;controller-&gt;get_militancy_mod();</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            pop.con += 0.01f * province-&gt;controller-&gt;get_militancy_mod();</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    });</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <a class="code" href="emigration_8cpp.html#a90da5251c45a88775a56c0586a53c48b">do_emigration</a>(world);</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">// Chances of a coup/rebellion increment for the global militancy</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; nation : world.nations) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        <span class="comment">// Nation must actually exist</span></div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <span class="keywordflow">if</span>(!nation-&gt;exists()) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="comment">// Do research on focused research</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">if</span>(nation-&gt;focus_tech != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">float</span> research = nation-&gt;get_research_points() / nation-&gt;focus_tech-&gt;cost;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            nation-&gt;research[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(nation-&gt;focus_tech)] += research;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        }</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        <span class="comment">// Total anger in population (global)</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordtype">float</span> total_anger = 0.f;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="comment">// Anger per ideology (how much we hate the current ideology)</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        std::vector&lt;float&gt; ideology_anger(world.ideologies.size(), 0.f);</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">float</span> coup_chances = 1000.f;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; province : nation-&gt;owned_provinces) {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;            <span class="comment">// Nobody can coup from occupied territory!</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <span class="keywordflow">if</span>(province-&gt;controller != nation) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            }</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160; </div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pop : province-&gt;pops) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                <span class="comment">// TODO: Ok, look, the justification is that educated people</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                <span class="comment">// almost never do coups - in comparasion to uneducated</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                <span class="comment">// peseants, rich people don&#39;t need to protest!</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">float</span> anger = (pop.militancy * pop.con) / std::max(pop.literacy, 1.f) / std::max(pop.life_needs_met, 0.f);</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                total_anger += anger;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160; </div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; ideology : world.ideologies) {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                    ideology_anger[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(ideology)] += (pop.ideology_approval[world.<a class="code" href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">get_id</a>(ideology)] * anger) * (pop.size / 1000.f);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                }</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            }</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="comment">// Rebellions!</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="comment">// TODO: Broadcast this event to other people, maybe a REBEL_UPRISE action with a list of uprising provinces?</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keywordflow">if</span>(std::fmod(rand(), std::max(coup_chances, coup_chances - total_anger)) &lt;= 100.f) {</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <span class="comment">// Compile list of uprising provinces</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            std::vector&lt;Province*&gt; uprising_provinces;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; province : nation-&gt;owned_provinces) {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                <span class="keywordtype">float</span> province_anger = 0.f;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                <span class="keywordtype">float</span> province_threshold = 0.f;</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; pop : province-&gt;pops) {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                    province_anger += pop.militancy * pop.con;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                    province_threshold += pop.literacy * pop.life_needs_met;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                }</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160; </div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                <span class="keywordflow">if</span>(province_anger &gt; province_threshold) {</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                    uprising_provinces.push_back(province);</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            }</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160; </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="comment">// Make the most angry provinces revolt!</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; province : uprising_provinces) {</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                <span class="comment">// TODO: We should make a copy of the `rebel` nation for every rebellion!!!</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <span class="comment">// TODO: We should also give them an unique ideology!!!</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                world.nations[0]-&gt;give_province(*province);</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            }</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        <span class="comment">// Roll a dice! (more probability with more anger!)</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">if</span>(std::fmod(rand(), std::max(coup_chances, coup_chances - total_anger)) &lt;= 100.f) {</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="comment">// Choose the ideology with most &quot;anger&quot; (the one more probable to coup d&#39;</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="comment">// etat) - amgry radicals will surely throw off the current administration</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <span class="comment">// while peaceful people won&#39;t</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="keywordtype">int</span> idx = std::distance(ideology_anger.begin(), std::max_element(ideology_anger.begin(), ideology_anger.end()));</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160; </div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <span class="comment">// Ideology_anger and ideologies are mapped 1:1 - so we just pick up the associated ideology</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <span class="comment">// Apply the policies of the ideology</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            nation-&gt;current_policy = world.ideologies[idx]-&gt;policies;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <span class="comment">// Switch ideologies of nation</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            nation-&gt;ideology = world.ideologies[idx];</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            <span class="comment">// People who are aligned to the ideology are VERY happy now</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; province : nation-&gt;owned_provinces) {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; pop : province-&gt;pops) {</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                    pop.militancy = -50.f;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            }</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160; </div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            <a class="code" href="print_8hpp.html#a4d6d61888d367fc052c4491545bd0560">print_info</a>(<span class="stringliteral">&quot;Coup d&#39; etat on [%s]! [%s] has taken over!&quot;</span>, nation-&gt;ref_name.c_str(), nation-&gt;ideology-&gt;ref_name.c_str());</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    }</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    <span class="comment">// Phase 4 of the economy: After all POPs buy their products and all factories have transported their goods (or not)</span></div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="comment">// the price of each product is calculated and all markets are closed until the next day</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="comment">// Reset production costs</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; building : world.buildings) {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        building-&gt;production_cost = 0.f;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    }</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160; </div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="comment">// Close today&#39;s price with a change according to demand - supply</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; product : world.products) {</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">if</span>(product == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        }</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160; </div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="comment">// Uncomment to see supply-demand</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="comment">//if(product-&gt;price_vel &amp;&amp; product-&gt;price &gt; 0.01f)</span></div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="comment">//    print_info(&quot;%s; Supply: %zu, Demand: %zu, Price %.2f&quot;, product-&gt;good-&gt;name.c_str(), product-&gt;supply, product-&gt;demand, product-&gt;price);</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        product-&gt;close_market();</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        product-&gt;demand = 0;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="aclass_policies_html"><div class="ttname"><a href="class_policies.html">Policies</a></div><div class="ttdef"><b>Definition:</b> <a href="policy_8hpp_source.html#l00088">policy.hpp:88</a></div></div>
<div class="ttc" id="aclass_unit_html_a92c7132df3c497b8a1d970e10ec0da58"><div class="ttname"><a href="class_unit.html#a92c7132df3c497b8a1d970e10ec0da58">Unit::supply</a></div><div class="ttdeci">float supply</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00132">unit.hpp:132</a></div></div>
<div class="ttc" id="aaction_8hpp_html_a21d5e8f8cdaa838586b31007df0a950b"><div class="ttname"><a href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950b">ActionType</a></div><div class="ttdeci">ActionType</div><div class="ttdef"><b>Definition:</b> <a href="action_8hpp_source.html#l00031">action.hpp:31</a></div></div>
<div class="ttc" id="aclass_entity_html_abdfc45f6142500ce5600bf056823b9eb"><div class="ttname"><a href="class_entity.html#abdfc45f6142500ce5600bf056823b9eb">Entity&lt; uint16_t &gt;::Id</a></div><div class="ttdeci">uint16_t Id</div><div class="ttdef"><b>Definition:</b> <a href="entity_8hpp_source.html#l00034">entity.hpp:34</a></div></div>
<div class="ttc" id="aworld_8hpp_html_a57124e387290311f33f3b54a54930418aefdb39a4c7286afcecf0e8a7435fce6a"><div class="ttname"><a href="world_8hpp.html#a57124e387290311f33f3b54a54930418aefdb39a4c7286afcecf0e8a7435fce6a">OrderType::POP</a></div><div class="ttdeci">@ POP</div></div>
<div class="ttc" id="aclass_building_html_a8b40ee6a2682be3b890df777377fe1c0"><div class="ttname"><a href="class_building.html#a8b40ee6a2682be3b890df777377fe1c0">Building::add_to_stock</a></div><div class="ttdeci">void add_to_stock(const Good &amp;good, size_t add)</div><div class="ttdef"><b>Definition:</b> <a href="building_8cpp_source.html#l00059">building.cpp:59</a></div></div>
<div class="ttc" id="aworld_8hpp_html_a57124e387290311f33f3b54a54930418aec8fc2c42b9c76effd648a14b311411f"><div class="ttname"><a href="world_8hpp.html#a57124e387290311f33f3b54a54930418aec8fc2c42b9c76effd648a14b311411f">OrderType::UNIT</a></div><div class="ttdeci">@ UNIT</div></div>
<div class="ttc" id="aclass_world_html_a414eabf82ea5586d568450c46e55a53a"><div class="ttname"><a href="class_world.html#a414eabf82ea5586d568450c46e55a53a">World::insert</a></div><div class="ttdeci">void insert(T *ptr)</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00178">world.hpp:178</a></div></div>
<div class="ttc" id="aclass_order_goods_html_a47150f5c008ccabd9afd03ee21496ab7"><div class="ttname"><a href="class_order_goods.html#a47150f5c008ccabd9afd03ee21496ab7">OrderGoods::building</a></div><div class="ttdeci">Building * building</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00086">world.hpp:86</a></div></div>
<div class="ttc" id="apolicy_8hpp_html_a4d4d7a8da93e4613d8962b1bdabd2ed2ad96ea9c137d1222a9096df439331f40f"><div class="ttname"><a href="policy_8hpp.html#a4d4d7a8da93e4613d8962b1bdabd2ed2ad96ea9c137d1222a9096df439331f40f">TREATMENT_ONLY_ACCEPTED</a></div><div class="ttdeci">@ TREATMENT_ONLY_ACCEPTED</div><div class="ttdef"><b>Definition:</b> <a href="policy_8hpp_source.html#l00074">policy.hpp:74</a></div></div>
<div class="ttc" id="aclass_deliver_goods_html_a6e3be06b7461e173316b2cb62770fb1d"><div class="ttname"><a href="class_deliver_goods.html#a6e3be06b7461e173316b2cb62770fb1d">DeliverGoods::payment</a></div><div class="ttdeci">float payment</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00104">world.hpp:104</a></div></div>
<div class="ttc" id="apolicy_8hpp_html_a4d4d7a8da93e4613d8962b1bdabd2ed2aa2494cd90fcce48b63778004d092747d"><div class="ttname"><a href="policy_8hpp.html#a4d4d7a8da93e4613d8962b1bdabd2ed2aa2494cd90fcce48b63778004d092747d">TREATMENT_EXTERMINATE</a></div><div class="ttdeci">@ TREATMENT_EXTERMINATE</div><div class="ttdef"><b>Definition:</b> <a href="policy_8hpp_source.html#l00080">policy.hpp:80</a></div></div>
<div class="ttc" id="aclass_archive_html"><div class="ttname"><a href="class_archive.html">Archive</a></div><div class="ttdef"><b>Definition:</b> <a href="serializer_8hpp_source.html#l00056">serializer.hpp:56</a></div></div>
<div class="ttc" id="aclass_workers_html_a8745b24f7772e1d286212d010cb5c6cd"><div class="ttname"><a href="class_workers.html#a8745b24f7772e1d286212d010cb5c6cd">Workers::Workers</a></div><div class="ttdeci">Workers(Pop &amp;_pop)</div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00055">economy.cpp:55</a></div></div>
<div class="ttc" id="aclass_unified_render_1_1_networking_1_1_packet_html"><div class="ttname"><a href="class_unified_render_1_1_networking_1_1_packet.html">UnifiedRender::Networking::Packet</a></div><div class="ttdef"><b>Definition:</b> <a href="network_8hpp_source.html#l00089">network.hpp:89</a></div></div>
<div class="ttc" id="aclass_building_html_a667f82bbfacc3e503b240c8a5a84451d"><div class="ttname"><a href="class_building.html#a667f82bbfacc3e503b240c8a5a84451d">Building::willing_payment</a></div><div class="ttdeci">size_t willing_payment</div><div class="ttdef"><b>Definition:</b> <a href="building_8hpp_source.html#l00117">building.hpp:117</a></div></div>
<div class="ttc" id="aclass_deliver_goods_html"><div class="ttname"><a href="class_deliver_goods.html">DeliverGoods</a></div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00101">world.hpp:101</a></div></div>
<div class="ttc" id="aclass_refname_entity_html_af7cab6ed6df7dc18b4022a76e7faa0f6"><div class="ttname"><a href="class_refname_entity.html#af7cab6ed6df7dc18b4022a76e7faa0f6">RefnameEntity::ref_name</a></div><div class="ttdeci">std::string ref_name</div><div class="ttdef"><b>Definition:</b> <a href="entity_8hpp_source.html#l00051">entity.hpp:51</a></div></div>
<div class="ttc" id="agood_8hpp_html"><div class="ttname"><a href="good_8hpp.html">good.hpp</a></div></div>
<div class="ttc" id="aclass_unit_html_af0fc19a0b834d99a79e320bbb323f1a7"><div class="ttname"><a href="class_unit.html#af0fc19a0b834d99a79e320bbb323f1a7">Unit::budget</a></div><div class="ttdeci">float budget</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00135">unit.hpp:135</a></div></div>
<div class="ttc" id="apop_8hpp_html_a45bfee423bff946a96f64c0b1f9ca1b5afe25c0ad752c03ce2361025c235b63e1"><div class="ttname"><a href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5afe25c0ad752c03ce2361025c235b63e1">PopGroup::Slave</a></div><div class="ttdeci">@ Slave</div></div>
<div class="ttc" id="aclass_deliver_goods_html_a7406c05c8810773dc81a046a9f0daea3"><div class="ttname"><a href="class_deliver_goods.html#a7406c05c8810773dc81a046a9f0daea3">DeliverGoods::province</a></div><div class="ttdeci">Province * province</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00119">world.hpp:119</a></div></div>
<div class="ttc" id="aclass_unified_render_1_1_networking_1_1_packet_html_a572c99ae39603961d621eef977312fbe"><div class="ttname"><a href="class_unified_render_1_1_networking_1_1_packet.html#a572c99ae39603961d621eef977312fbe">UnifiedRender::Networking::Packet::data</a></div><div class="ttdeci">void * data(void)</div><div class="ttdef"><b>Definition:</b> <a href="network_8cpp_source.html#l00088">network.cpp:88</a></div></div>
<div class="ttc" id="aclass_province_html_aaf4829410565c77193db7e5ec474d916"><div class="ttname"><a href="class_province.html#aaf4829410565c77193db7e5ec474d916">Province::supply_rem</a></div><div class="ttdeci">float supply_rem</div><div class="ttdef"><b>Definition:</b> <a href="province_8hpp_source.html#l00077">province.hpp:77</a></div></div>
<div class="ttc" id="aserver__network_8hpp_html"><div class="ttname"><a href="server__network_8hpp.html">server_network.hpp</a></div></div>
<div class="ttc" id="aclass_unit_type_html_ae1080a28864c59aee1eea89313f8f7b4"><div class="ttname"><a href="class_unit_type.html#ae1080a28864c59aee1eea89313f8f7b4">UnitType::max_health</a></div><div class="ttdeci">float max_health</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00047">unit.hpp:47</a></div></div>
<div class="ttc" id="aworld_8hpp_html"><div class="ttname"><a href="world_8hpp.html">world.hpp</a></div></div>
<div class="ttc" id="aclass_unit_html_ade569a5a70e47be8c0b98b2c27eb0dc5"><div class="ttname"><a href="class_unit.html#ade569a5a70e47be8c0b98b2c27eb0dc5">Unit::base</a></div><div class="ttdeci">size_t base</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00110">unit.hpp:110</a></div></div>
<div class="ttc" id="aclass_unit_html_aa1ba06b112a04b64523abe7ae9033c23"><div class="ttname"><a href="class_unit.html#aa1ba06b112a04b64523abe7ae9033c23">Unit::experience</a></div><div class="ttdeci">float experience</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00122">unit.hpp:122</a></div></div>
<div class="ttc" id="aserver__network_8cpp_html_a4528211a12b7127900078415d20510af"><div class="ttname"><a href="server__network_8cpp.html#a4528211a12b7127900078415d20510af">g_server</a></div><div class="ttdeci">Server * g_server</div><div class="ttdef"><b>Definition:</b> <a href="server__network_8cpp_source.html#l00041">server_network.cpp:41</a></div></div>
<div class="ttc" id="aclass_world_html"><div class="ttname"><a href="class_world.html">World</a></div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00138">world.hpp:138</a></div></div>
<div class="ttc" id="aprint_8hpp_html_a4d6d61888d367fc052c4491545bd0560"><div class="ttname"><a href="print_8hpp.html#a4d6d61888d367fc052c4491545bd0560">print_info</a></div><div class="ttdeci">void print_info(const char *str,...)</div><div class="ttdef"><b>Definition:</b> <a href="print_8cpp_source.html#l00076">print.cpp:76</a></div></div>
<div class="ttc" id="aclass_unified_render_1_1_networking_1_1_server_html_a1b478ce1f62b20d08bbae558bee6053f"><div class="ttname"><a href="class_unified_render_1_1_networking_1_1_server.html#a1b478ce1f62b20d08bbae558bee6053f">UnifiedRender::Networking::Server::broadcast</a></div><div class="ttdeci">void broadcast(const UnifiedRender::Networking::Packet &amp;packet)</div><div class="ttdef"><b>Definition:</b> <a href="network_8cpp_source.html#l00273">network.cpp:273</a></div></div>
<div class="ttc" id="aclass_archive_html_a83d3cc33add24511ced9c7e7d467a09c"><div class="ttname"><a href="class_archive.html#a83d3cc33add24511ced9c7e7d467a09c">Archive::size</a></div><div class="ttdeci">size_t size(void)</div><div class="ttdef"><b>Definition:</b> <a href="serializer_8cpp_source.html#l00085">serializer.cpp:85</a></div></div>
<div class="ttc" id="aworld_8hpp_html_a57124e387290311f33f3b54a54930418a71a6834884666147c0334f0c40bc7295"><div class="ttname"><a href="world_8hpp.html#a57124e387290311f33f3b54a54930418a71a6834884666147c0334f0c40bc7295">OrderType::BUILDING</a></div><div class="ttdeci">@ BUILDING</div></div>
<div class="ttc" id="aclass_unit_html_a2ed994b8257c603d540e2f08b1fe0f57"><div class="ttname"><a href="class_unit.html#a2ed994b8257c603d540e2f08b1fe0f57">Unit::defensive_ticks</a></div><div class="ttdeci">uint64_t defensive_ticks</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00129">unit.hpp:129</a></div></div>
<div class="ttc" id="aclass_policies_html_afa12584fab46c94ce06e9fd4a6119a03"><div class="ttname"><a href="class_policies.html#afa12584fab46c94ce06e9fd4a6119a03">Policies::domestic_import_tax</a></div><div class="ttdeci">float domestic_import_tax</div><div class="ttdef"><b>Definition:</b> <a href="policy_8hpp_source.html#l00143">policy.hpp:143</a></div></div>
<div class="ttc" id="aclass_workers_html_a3ddac131401b8cb1acc30c533f992f20"><div class="ttname"><a href="class_workers.html#a3ddac131401b8cb1acc30c533f992f20">Workers::pop</a></div><div class="ttdeci">Pop &amp; pop</div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00053">economy.cpp:53</a></div></div>
<div class="ttc" id="aclass_order_goods_html_a0beab55beccbb50334d007b79b2b8226"><div class="ttname"><a href="class_order_goods.html#a0beab55beccbb50334d007b79b2b8226">OrderGoods::province</a></div><div class="ttdeci">Province * province</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00089">world.hpp:89</a></div></div>
<div class="ttc" id="aclass_policies_html_a2f4987a4a786ea69a700b71b3c63c088"><div class="ttname"><a href="class_policies.html#a2f4987a4a786ea69a700b71b3c63c088">Policies::import_tax</a></div><div class="ttdeci">float import_tax</div><div class="ttdef"><b>Definition:</b> <a href="policy_8hpp_source.html#l00137">policy.hpp:137</a></div></div>
<div class="ttc" id="aclass_building_html_a9025c30bac0ba3a0c9092726e643c43c"><div class="ttname"><a href="class_building.html#a9025c30bac0ba3a0c9092726e643c43c">Building::get_owner</a></div><div class="ttdeci">Nation * get_owner(void)</div><div class="ttdef"><b>Definition:</b> <a href="building_8cpp_source.html#l00075">building.cpp:75</a></div></div>
<div class="ttc" id="aclass_unit_html_a459c322351b83aeb29a33f3a5e192bda"><div class="ttname"><a href="class_unit.html#a459c322351b83aeb29a33f3a5e192bda">Unit::set_province</a></div><div class="ttdeci">void set_province(Province &amp;province)</div><div class="ttdef"><b>Definition:</b> <a href="unit_8cpp_source.html#l00156">unit.cpp:156</a></div></div>
<div class="ttc" id="aclass_policies_html_afb13cbaf9d9c21d136c9f484d5162605"><div class="ttname"><a href="class_policies.html#afb13cbaf9d9c21d136c9f484d5162605">Policies::export_tax</a></div><div class="ttdeci">float export_tax</div><div class="ttdef"><b>Definition:</b> <a href="policy_8hpp_source.html#l00140">policy.hpp:140</a></div></div>
<div class="ttc" id="aclass_world_html_aa1f1181da420bc00877e11997c8a05fa"><div class="ttname"><a href="class_world.html#aa1f1181da420bc00877e11997c8a05fa">World::delivers_mutex</a></div><div class="ttdeci">std::mutex delivers_mutex</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00245">world.hpp:245</a></div></div>
<div class="ttc" id="aaction_8hpp_html_a21d5e8f8cdaa838586b31007df0a950babe7a91c1d60fbbbcab57ee6b6d4484c9"><div class="ttname"><a href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950babe7a91c1d60fbbbcab57ee6b6d4484c9">ActionType::UNIT_ADD</a></div><div class="ttdeci">@ UNIT_ADD</div></div>
<div class="ttc" id="aclass_available_workers_html_a8f85a039ce3df6c543ad183b05d2fad9"><div class="ttname"><a href="class_available_workers.html#a8f85a039ce3df6c543ad183b05d2fad9">AvailableWorkers::farmers</a></div><div class="ttdeci">std::vector&lt; Workers &gt; farmers</div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00067">economy.cpp:67</a></div></div>
<div class="ttc" id="aclass_building_html_ac88484660cfc58d6cd400963b2f6950e"><div class="ttname"><a href="class_building.html#ac88484660cfc58d6cd400963b2f6950e">Building::production_cost</a></div><div class="ttdeci">float production_cost</div><div class="ttdef"><b>Definition:</b> <a href="building_8hpp_source.html#l00102">building.hpp:102</a></div></div>
<div class="ttc" id="aclass_world_html_a5b65f000301f0674415c521fc9821056"><div class="ttname"><a href="class_world.html#a5b65f000301f0674415c521fc9821056">World::delivers</a></div><div class="ttdeci">std::vector&lt; DeliverGoods &gt; delivers</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00244">world.hpp:244</a></div></div>
<div class="ttc" id="aworld_8hpp_html_a57124e387290311f33f3b54a54930418acb90f4484ab1c9ce5a9c4328bd3c8dbc"><div class="ttname"><a href="world_8hpp.html#a57124e387290311f33f3b54a54930418acb90f4484ab1c9ce5a9c4328bd3c8dbc">OrderType::INDUSTRIAL</a></div><div class="ttdeci">@ INDUSTRIAL</div></div>
<div class="ttc" id="aclass_province_html_a394ab431fc7f6b697e288e562898d123"><div class="ttname"><a href="class_province.html#a394ab431fc7f6b697e288e562898d123">Province::controller</a></div><div class="ttdeci">Nation * controller</div><div class="ttdef"><b>Definition:</b> <a href="province_8hpp_source.html#l00081">province.hpp:81</a></div></div>
<div class="ttc" id="aclass_workers_html"><div class="ttname"><a href="class_workers.html">Workers</a></div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00051">economy.cpp:51</a></div></div>
<div class="ttc" id="aclass_unit_html_a4ab07faf29a245f3ac4a5ee2215c7e36"><div class="ttname"><a href="class_unit.html#a4ab07faf29a245f3ac4a5ee2215c7e36">Unit::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00107">unit.hpp:107</a></div></div>
<div class="ttc" id="aclass_policies_html_a348b5a9b1b76c8822b9200d4a1ce2a4b"><div class="ttname"><a href="class_policies.html#a348b5a9b1b76c8822b9200d4a1ce2a4b">Policies::foreign_trade</a></div><div class="ttdeci">bool foreign_trade</div><div class="ttdef"><b>Definition:</b> <a href="policy_8hpp_source.html#l00134">policy.hpp:134</a></div></div>
<div class="ttc" id="aclass_workers_html_ab9fd04bfe946a3c2d2479ed93d7cadd8"><div class="ttname"><a href="class_workers.html#ab9fd04bfe946a3c2d2479ed93d7cadd8">Workers::amount</a></div><div class="ttdeci">size_t amount</div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00054">economy.cpp:54</a></div></div>
<div class="ttc" id="aclass_order_goods_html"><div class="ttname"><a href="class_order_goods.html">OrderGoods</a></div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00072">world.hpp:72</a></div></div>
<div class="ttc" id="aclass_order_goods_html_afe9740a8f611b2d3ef97b65ee8472666"><div class="ttname"><a href="class_order_goods.html#afe9740a8f611b2d3ef97b65ee8472666">OrderGoods::type</a></div><div class="ttdeci">enum OrderType type</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00074">world.hpp:74</a></div></div>
<div class="ttc" id="aclass_world_html_ae4bea99395c77d8afcbc54333e7b84a3"><div class="ttname"><a href="class_world.html#ae4bea99395c77d8afcbc54333e7b84a3">World::get_id</a></div><div class="ttdeci">size_t get_id(const Tile *ptr) const</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00197">world.hpp:197</a></div></div>
<div class="ttc" id="apop_8hpp_html_a45bfee423bff946a96f64c0b1f9ca1b5a6311ae17c1ee52b36e68aaf4ad066387"><div class="ttname"><a href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5a6311ae17c1ee52b36e68aaf4ad066387">PopGroup::Other</a></div><div class="ttdeci">@ Other</div></div>
<div class="ttc" id="aclass_available_workers_html_a939e674269cde77d66104c9fe17753bf"><div class="ttname"><a href="class_available_workers.html#a939e674269cde77d66104c9fe17753bf">AvailableWorkers::laborers</a></div><div class="ttdeci">std::vector&lt; Workers &gt; laborers</div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00068">economy.cpp:68</a></div></div>
<div class="ttc" id="aclass_unit_html_ab0f889c1dcbe02864fad1fa6af62aa37"><div class="ttname"><a href="class_unit.html#ab0f889c1dcbe02864fad1fa6af62aa37">Unit::type</a></div><div class="ttdeci">UnitType * type</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00104">unit.hpp:104</a></div></div>
<div class="ttc" id="aclass_world_html_ab132ceb31bcac554784a2c533a139395"><div class="ttname"><a href="class_world.html#ab132ceb31bcac554784a2c533a139395">World::orders</a></div><div class="ttdeci">std::vector&lt; OrderGoods &gt; orders</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00240">world.hpp:240</a></div></div>
<div class="ttc" id="aclass_nation_html_a03368edb43be9a4103f636cd83e7e600"><div class="ttname"><a href="class_nation.html#a03368edb43be9a4103f636cd83e7e600">Nation::current_policy</a></div><div class="ttdeci">Policies current_policy</div><div class="ttdef"><b>Definition:</b> <a href="nation_8hpp_source.html#l00194">nation.hpp:194</a></div></div>
<div class="ttc" id="aclass_province_html_a1638dc8d5631d507c6edf4e0a5a8e814"><div class="ttname"><a href="class_province.html#a1638dc8d5631d507c6edf4e0a5a8e814">Province::supply_limit</a></div><div class="ttdeci">float supply_limit</div><div class="ttdef"><b>Definition:</b> <a href="province_8hpp_source.html#l00074">province.hpp:74</a></div></div>
<div class="ttc" id="aclass_deliver_goods_html_adf837683a064e92a4b26ef03b5992f38"><div class="ttname"><a href="class_deliver_goods.html#adf837683a064e92a4b26ef03b5992f38">DeliverGoods::product</a></div><div class="ttdeci">Product * product</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00113">world.hpp:113</a></div></div>
<div class="ttc" id="aclass_world_html_a2ed877da2e26c03c419c21f1631d0725"><div class="ttname"><a href="class_world.html#a2ed877da2e26c03c419c21f1631d0725">World::orders_mutex</a></div><div class="ttdeci">std::mutex orders_mutex</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00241">world.hpp:241</a></div></div>
<div class="ttc" id="apop_8hpp_html_a45bfee423bff946a96f64c0b1f9ca1b5ad03ec8dec3adf3138f3ae310671d3311"><div class="ttname"><a href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5ad03ec8dec3adf3138f3ae310671d3311">PopGroup::LABORER</a></div><div class="ttdeci">@ LABORER</div></div>
<div class="ttc" id="aclass_deliver_goods_html_ad0d61a2b2e51ab005086ca43fabcbcd1"><div class="ttname"><a href="class_deliver_goods.html#ad0d61a2b2e51ab005086ca43fabcbcd1">DeliverGoods::building</a></div><div class="ttdeci">Building * building</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00116">world.hpp:116</a></div></div>
<div class="ttc" id="aclass_order_goods_html_a9bce5869eee50f3d78cc05b2ad333e59"><div class="ttname"><a href="class_order_goods.html#a9bce5869eee50f3d78cc05b2ad333e59">OrderGoods::quantity</a></div><div class="ttdeci">size_t quantity</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00083">world.hpp:83</a></div></div>
<div class="ttc" id="aclass_good_html_ab112bb52758716660c41803684e857fa"><div class="ttname"><a href="class_good.html#ab112bb52758716660c41803684e857fa">Good::is_edible</a></div><div class="ttdeci">bool is_edible</div><div class="ttdef"><b>Definition:</b> <a href="good_8hpp_source.html#l00035">good.hpp:35</a></div></div>
<div class="ttc" id="aclass_product_html_a68c5bf7bc5bddd2e1734d8ea1872e836"><div class="ttname"><a href="class_product.html#a68c5bf7bc5bddd2e1734d8ea1872e836">Product::good</a></div><div class="ttdeci">Good * good</div><div class="ttdef"><b>Definition:</b> <a href="product_8hpp_source.html#l00046">product.hpp:46</a></div></div>
<div class="ttc" id="aaction_8hpp_html_a21d5e8f8cdaa838586b31007df0a950bae62f4443f20859b05eed4e00137fbfe7"><div class="ttname"><a href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950bae62f4443f20859b05eed4e00137fbfe7">ActionType::BUILDING_REMOVE</a></div><div class="ttdeci">@ BUILDING_REMOVE</div></div>
<div class="ttc" id="aio__impl_8hpp_html"><div class="ttname"><a href="io__impl_8hpp.html">io_impl.hpp</a></div></div>
<div class="ttc" id="aclass_pop_html"><div class="ttname"><a href="class_pop.html">Pop</a></div><div class="ttdef"><b>Definition:</b> <a href="pop_8hpp_source.html#l00049">pop.hpp:49</a></div></div>
<div class="ttc" id="aeconomy_8hpp_html"><div class="ttname"><a href="economy_8hpp.html">economy.hpp</a></div></div>
<div class="ttc" id="aclass_nation_html_a14c5ba373fc7daf6dabc5e437d6f0b41"><div class="ttname"><a href="class_nation.html#a14c5ba373fc7daf6dabc5e437d6f0b41">Nation::budget</a></div><div class="ttdeci">float budget</div><div class="ttdef"><b>Definition:</b> <a href="nation_8hpp_source.html#l00170">nation.hpp:170</a></div></div>
<div class="ttc" id="aserializer_8hpp_html"><div class="ttname"><a href="serializer_8hpp.html">serializer.hpp</a></div></div>
<div class="ttc" id="aclass_deliver_goods_html_a7b126da233200a2b9c914c7a903770d1"><div class="ttname"><a href="class_deliver_goods.html#a7b126da233200a2b9c914c7a903770d1">DeliverGoods::good</a></div><div class="ttdeci">Good * good</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00107">world.hpp:107</a></div></div>
<div class="ttc" id="aaction_8hpp_html_a21d5e8f8cdaa838586b31007df0a950ba6c2b08f490c9fc0ad047ab644d3aa498"><div class="ttname"><a href="action_8hpp.html#a21d5e8f8cdaa838586b31007df0a950ba6c2b08f490c9fc0ad047ab644d3aa498">ActionType::BUILDING_UPDATE</a></div><div class="ttdeci">@ BUILDING_UPDATE</div></div>
<div class="ttc" id="aclass_available_workers_html"><div class="ttname"><a href="class_available_workers.html">AvailableWorkers</a></div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00064">economy.cpp:64</a></div></div>
<div class="ttc" id="aclass_order_goods_html_ad3a7abc7ad5331b9b554127290d443a9"><div class="ttname"><a href="class_order_goods.html#ad3a7abc7ad5331b9b554127290d443a9">OrderGoods::payment</a></div><div class="ttdeci">float payment</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00077">world.hpp:77</a></div></div>
<div class="ttc" id="aemigration_8cpp_html_a90da5251c45a88775a56c0586a53c48b"><div class="ttname"><a href="emigration_8cpp.html#a90da5251c45a88775a56c0586a53c48b">do_emigration</a></div><div class="ttdeci">void do_emigration(World &amp;world)</div><div class="ttdef"><b>Definition:</b> <a href="emigration_8cpp_source.html#l00057">emigration.cpp:57</a></div></div>
<div class="ttc" id="aclass_product_html_ad1fd6ee6c8653bf81898668b1d01b05d"><div class="ttname"><a href="class_product.html#ad1fd6ee6c8653bf81898668b1d01b05d">Product::price</a></div><div class="ttdeci">float price</div><div class="ttdef"><b>Definition:</b> <a href="product_8hpp_source.html#l00049">product.hpp:49</a></div></div>
<div class="ttc" id="apop_8hpp_html_a45bfee423bff946a96f64c0b1f9ca1b5a638d629a6f2e9ca3a3690b6a854a0717"><div class="ttname"><a href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5a638d629a6f2e9ca3a3690b6a854a0717">PopGroup::BURGEOISE</a></div><div class="ttdeci">@ BURGEOISE</div></div>
<div class="ttc" id="aclass_order_goods_html_a68b0235e745d82fbaa9a18b33910eb74"><div class="ttname"><a href="class_order_goods.html#a68b0235e745d82fbaa9a18b33910eb74">OrderGoods::good</a></div><div class="ttdeci">Good * good</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00080">world.hpp:80</a></div></div>
<div class="ttc" id="aclass_building_html_a66ac67d055da2cb3fe5a00755badba34"><div class="ttname"><a href="class_building.html#a66ac67d055da2cb3fe5a00755badba34">Building::req_goods</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; Good *, size_t &gt; &gt; req_goods</div><div class="ttdef"><b>Definition:</b> <a href="building_8hpp_source.html#l00087">building.hpp:87</a></div></div>
<div class="ttc" id="aclass_pop_html_a8b51e6065e766c302912653fa6c9c1ae"><div class="ttname"><a href="class_pop.html#a8b51e6065e766c302912653fa6c9c1ae">Pop::budget</a></div><div class="ttdeci">float budget</div><div class="ttdef"><b>Definition:</b> <a href="pop_8hpp_source.html#l00060">pop.hpp:60</a></div></div>
<div class="ttc" id="aclass_available_workers_html_a8b65a6141e47031474a062c35b5437d4"><div class="ttname"><a href="class_available_workers.html#a8b65a6141e47031474a062c35b5437d4">AvailableWorkers::entrepreneurs</a></div><div class="ttdeci">std::vector&lt; Workers &gt; entrepreneurs</div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00066">economy.cpp:66</a></div></div>
<div class="ttc" id="aemigration_8hpp_html"><div class="ttname"><a href="emigration_8hpp.html">emigration.hpp</a></div></div>
<div class="ttc" id="aclass_archive_html_a4058a4361793f2214b9ca27f4f4d6b74"><div class="ttname"><a href="class_archive.html#a4058a4361793f2214b9ca27f4f4d6b74">Archive::get_buffer</a></div><div class="ttdeci">void * get_buffer(void)</div><div class="ttdef"><b>Definition:</b> <a href="serializer_8cpp_source.html#l00076">serializer.cpp:76</a></div></div>
<div class="ttc" id="apop_8hpp_html_a45bfee423bff946a96f64c0b1f9ca1b5a7717dca1543a25f26c3c40d28865d638"><div class="ttname"><a href="pop_8hpp.html#a45bfee423bff946a96f64c0b1f9ca1b5a7717dca1543a25f26c3c40d28865d638">PopGroup::FARMER</a></div><div class="ttdeci">@ FARMER</div></div>
<div class="ttc" id="anamespace_economy_html_a488d7af1a7c2420a09739101ae79fddd"><div class="ttname"><a href="namespace_economy.html#a488d7af1a7c2420a09739101ae79fddd">Economy::do_tick</a></div><div class="ttdeci">void do_tick(World &amp;world)</div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00118">economy.cpp:118</a></div></div>
<div class="ttc" id="aclass_unit_html_a7fecad7239d042c63f6fb35654bc6228"><div class="ttname"><a href="class_unit.html#a7fecad7239d042c63f6fb35654bc6228">Unit::owner</a></div><div class="ttdeci">Nation * owner</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00117">unit.hpp:117</a></div></div>
<div class="ttc" id="aclass_world_html_a185d53b9f3e8d886f3f955c2c65b8725"><div class="ttname"><a href="class_world.html#a185d53b9f3e8d886f3f955c2c65b8725">World::remove</a></div><div class="ttdeci">void remove(T *ptr)</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00185">world.hpp:185</a></div></div>
<div class="ttc" id="aprint_8hpp_html"><div class="ttname"><a href="print_8hpp.html">print.hpp</a></div></div>
<div class="ttc" id="aclass_policies_html_ac400ba31e84b53535aaada9a79e22ad4"><div class="ttname"><a href="class_policies.html#ac400ba31e84b53535aaada9a79e22ad4">Policies::domestic_export_tax</a></div><div class="ttdeci">float domestic_export_tax</div><div class="ttdef"><b>Definition:</b> <a href="policy_8hpp_source.html#l00146">policy.hpp:146</a></div></div>
<div class="ttc" id="aaction_8hpp_html"><div class="ttname"><a href="action_8hpp.html">action.hpp</a></div></div>
<div class="ttc" id="athread__pool_8hpp_html"><div class="ttname"><a href="thread__pool_8hpp.html">thread_pool.hpp</a></div></div>
<div class="ttc" id="aclass_unit_html_a39f6e9f21ee9a4ec4f54a8eb39745c26"><div class="ttname"><a href="class_unit.html#a39f6e9f21ee9a4ec4f54a8eb39745c26">Unit::morale</a></div><div class="ttdeci">float morale</div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00119">unit.hpp:119</a></div></div>
<div class="ttc" id="aclass_product_html_a3320d60d1ed5704af3b59788610dd0ca"><div class="ttname"><a href="class_product.html#a3320d60d1ed5704af3b59788610dd0ca">Product::supply</a></div><div class="ttdeci">size_t supply</div><div class="ttdef"><b>Definition:</b> <a href="product_8hpp_source.html#l00055">product.hpp:55</a></div></div>
<div class="ttc" id="aclass_deliver_goods_html_a5e327f65877f813e61c62f2ad0715d76"><div class="ttname"><a href="class_deliver_goods.html#a5e327f65877f813e61c62f2ad0715d76">DeliverGoods::quantity</a></div><div class="ttdeci">size_t quantity</div><div class="ttdef"><b>Definition:</b> <a href="world_8hpp_source.html#l00110">world.hpp:110</a></div></div>
<div class="ttc" id="aproduct_8hpp_html"><div class="ttname"><a href="product_8hpp.html">product.hpp</a></div></div>
<div class="ttc" id="aserializer_8hpp_html_a0de36c411404bc17fd91b94b25823552"><div class="ttname"><a href="serializer_8hpp.html#a0de36c411404bc17fd91b94b25823552">serialize</a></div><div class="ttdeci">void serialize(Archive &amp;ar, const T *obj)</div><div class="ttdef"><b>Definition:</b> <a href="serializer_8hpp_source.html#l00087">serializer.hpp:87</a></div></div>
<div class="ttc" id="aclass_unit_html"><div class="ttname"><a href="class_unit.html">Unit</a></div><div class="ttdef"><b>Definition:</b> <a href="unit_8hpp_source.html#l00090">unit.hpp:90</a></div></div>
<div class="ttc" id="aclass_province_html_a9e169c16f63d4bc6d4b822a188f5d650"><div class="ttname"><a href="class_province.html#a9e169c16f63d4bc6d4b822a188f5d650">Province::stockpile</a></div><div class="ttdeci">std::vector&lt; size_t &gt; stockpile</div><div class="ttdef"><b>Definition:</b> <a href="province_8hpp_source.html#l00092">province.hpp:92</a></div></div>
<div class="ttc" id="aclass_workers_html_a6c20281a83794093cb670b0f03cd45c4"><div class="ttname"><a href="class_workers.html#a6c20281a83794093cb670b0f03cd45c4">Workers::operator=</a></div><div class="ttdeci">Workers &amp; operator=(const Workers &amp;workers)</div><div class="ttdef"><b>Definition:</b> <a href="economy_8cpp_source.html#l00057">economy.cpp:57</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_37c6514aeece95293041e34c0f2e0784.html">game</a></li><li class="navelem"><a class="el" href="dir_fd1fc52505cfa4c86ecd59c02433df11.html">src</a></li><li class="navelem"><a class="el" href="dir_ca0f7047b3597525f94d5ce491d29e3a.html">server</a></li><li class="navelem"><a class="el" href="economy_8cpp.html">economy.cpp</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
